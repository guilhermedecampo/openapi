name: Comentar no PR o diff das specs
on: 
  pull_request:
    branches:
      - "main"
jobs:
  list_diff:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Running OpenAPI Spec diff action
      id: oasdiff
      uses: oasdiff/oasdiff-action/diff@main
      env:
        GITHUB_TOKEN: ${{ secrets.OASDIFF_TOKEN }}
      with:
        base: './swagger-apis/automatic-payments/1.0.0-beta.1.yml'
        revision: './swagger-apis/automatic-payments/1.0.0-beta.2.yml'

    - name: Post oasdiff report
      uses: peter-evans/create-or-update-comment@v3
      env:
        GITHUB_TOKEN: ${{ secrets.OASDIFF_TOKEN }}
      with:
        issue-number: ${{ github.event.pull_request.number }}
        body: |
          <!-- bot:oasdiff -->
          Found these breaking changes on the public API:

          ```
          ${{ steps.oasdiff.outputs.diff }}
          ```
